<p-toolbar>
  <div class="p-toolbar-group-left">
    <div style="padding-right: 10px;">
      <button [disabled]="form.invalid" pButton pRipple label="Записать" icon="pi pi-save"
        class="p-button-secondary p-mr-2" (click)="saveDoc(false)"></button>
    </div>
    <button [disabled]="form.invalid" pButton pRipple label="Записать и закрыть" icon="pi pi-save"
      class="p-button-info p-mr-2" (click)="saveDoc(true)"></button>
  </div>

  <div class="p-toolbar-group-right">
    <div style="padding-right: 10px;">
      <p-splitButton appendTo="body" label="Еще" [model]="this.items"
        styleClass="p-button-outlined p-button-plain p-mr-2"></p-splitButton>
    </div>
    <div>
      <button pButton pRipple type="button" icon="pi pi-times" class="p-button-outlined p-button-plain p-mr-2"
        styleClass="p-button-sm" (click)="closeform(true)"></button>
    </div>
  </div>
</p-toolbar>

<div class="card" *ngIf="(Ras4et_detail) as Ras4et_detail; else loader">
  <form class="card" [formGroup]="form" style="display: flex; padding-bottom: 10px;">

    <div class="p-field" style="padding-right: 10px; width: 70%;">

      <label for="name_doc">Наименование <span style="color: red;">*</span></label>
      <div class="p-inputgroup">
        <input id="name_doc" type="text" pInputText [readOnly]="true" [(ngModel)]="Ras4et_detail.head._form.head_form"
          formControlName="name_doc" />
      </div>
      <span class="p-invalid" *ngIf="form.controls['name_doc'].invalid && form.controls['name_doc'].touched">
        <span *ngIf="form.controls['name_doc'].errors?.required">Наименование не должно быть пустым</span>
      </span>
    </div>


    <div class="p-field" style="min-width: 20rem;">
      <label for="spec_name">Специфика<span style="color: red;">*</span></label>
      <div class="p-inputgroup">
        <input id="spec_name" type="text" pInputText [readOnly]="true" [(ngModel)]="Ras4et_detail.head._spec.code"
          formControlName="spec_name" />
        <!-- <span class="p-inputgroup-addon cursor-pointer" (click)="selectfkr()">...</span> -->
      </div>
      <span class="p-invalid" *ngIf="form.controls['spec_name'].invalid && form.controls['spec_name'].touched">
        <span *ngIf="form.controls['spec_name'].errors?.required">Специфика не должна быть пустой</span>
      </span>
    </div>


  </form>


  <div style="padding: 0 0 10px 10px;">
    <button pButton pRipple label="добавить" icon="pi pi-plus" class="p-button-success p-mr-2"
      (click)="add_tbl()"></button>
  </div>

  <p-table styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines">
    <ng-template pTemplate="header" style="width: 100%;">
      <tr style="text-align: center; font-weight: 700;">
        <th style="text-align: center; width: 2.5%;">Номер</th>
        <th style="text-align: center; width: 10%;" *ngFor="let header of Ras4et_detail.head_table">{{ header }}</th>
      </tr>
    </ng-template>

  </p-table>
  <p-table [value]="children" styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines">
    <ng-template let-ChildItem let-ri="rowIndex" pTemplate="body" style="width: 100%;">
      <tr>
        <td style="text-align: center; width: 2.5%;">{{ri + 1}}</td>
        <td *ngFor="let kolon of ChildItem" style="text-align: center; width: 10%;">
          <!-- енстру -->
          <div class="p-inputgroup" *ngIf="kolon.zn == 'enstru'">
            <input id="enstru" type="text" [ngModel]="kolon.zn_enstru.name_rus" [readonly]="true" style="width: 100%;">
            <span class="p-inputgroup-addon cursor-pointer" (click)="selectENSTRU(kolon.zn_enstru)">...</span>
          </div>
          <!-- число -->

          <input type="number" *ngIf="kolon.zn == 'float'" [ngModel]="kolon.zn_float" style="width: 100%;"
            (ngModelChange)="onInputChange($event, kolon, ri)">
          <!-- единица измерения -->
          <div class="p-inputgroup" *ngIf="kolon.zn == 'ed_izm'">
            <input type="text" [ngModel]="kolon.zn_ed_izm.name" [readonly]="true" style="width: 100%;">
            <span class="p-inputgroup-addon cursor-pointer" (click)="selectEd_Izm(kolon.zn_ed_izm)">...</span>
          </div>
          <!-- категория сотрудников -->
          <input type="button" *ngIf="kolon.zn == 'category_sotr'" [ngModel]="kolon.zn_category_sotr.name"
            [readonly]="true" (click)="selectCategorySotr(kolon.zn_category_sotr)" style="width: 100%;">
          <!-- должность -->
          <input type="button" *ngIf="kolon.zn == 'dolzhnost'" [ngModel]="kolon.zn_dolzhnost.name_rus" [readonly]="true"
            (click)="selectDolzhnost(kolon.zn_dolzhnost)" style="width: 100%;">
          <!-- подразделение -->
          <input type="button" *ngIf="kolon.zn == 'podrazdelenie'" [ngModel]="kolon.zn_podrazdelenie.name_rus"
            [readonly]="true" (click)="selectPodrazdelenie(kolon.zn_podrazdelenie)" style="width: 100%;">
          <!-- доплата и надбавка -->
          <input type="button" *ngIf="kolon.zn == 'dopl_nadb'" [ngModel]="kolon.zn_dopl_nadb.name_rus" [readonly]="true"
            (click)="selectDoplNadb(kolon.zn_dopl_nadb)" style="width: 100%;">
          <!-- области регионов -->
          <input type="button" *ngIf="kolon.zn == 'oblasti_reg'" [ngModel]="kolon.zn_oblasti_reg.name" [readonly]="true"
            (click)="selectOblreg(kolon.zn_oblasti_reg)" style="width: 100%;">
          <!-- марки авто -->
          <input type="button" *ngIf="kolon.zn == 'marki_avto'" [ngModel]="kolon.zn_marki_avto.name" [readonly]="true"
            (click)="selectMarkiAvto(kolon.zn_marki_avto)" style="width: 100%;">
          <!-- стаж категорий -->
          <input type="button" *ngIf="kolon.zn == 'stazh_category'" [ngModel]="kolon.zn_stazh_category.name"
            [readonly]="true" (click)="selectStazh(kolon.zn_stazh_category)" style="width: 100%;">
        </td>
      </tr>
    </ng-template>
  </p-table>

  <ng-template #empty>
    <div class="center">
      Нет ни одной записи
    </div>
  </ng-template>
</div>

<p-confirmDialog [closeOnEscape]="true" acceptLabel="Да" rejectLabel="Нет" [style]="{width: '450px'}">
</p-confirmDialog>

<ng-template #loader>
  <app-skeleton></app-skeleton>
</ng-template>